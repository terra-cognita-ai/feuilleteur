var rt=Object.defineProperty;var st=(l,e,t)=>e in l?rt(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var qe=(l,e,t)=>st(l,typeof e!="symbol"?e+"":e,t);import{P as lt,Q as nt,J as pe,D as at,s as ne,r as ie,i as j,n as fe,f as _,e as v,t as I,c as w,b as S,d as U,h,j as Y,a as R,m as he,g as A,R as we,S as Z,o as k,G as ot,T as Te,U as x,V as Ve,B as Ke,W as ut,l as ct,u as it,p as ft,q as ht,X as Oe,Y as Ye,w as mt}from"../chunks/scheduler.xWvB5Pfl.js";import{g as ye,a as M,c as Ee,t as F,S as ae,i as oe,b as ee,d as te,m as re,e as se}from"../chunks/index.BNVms-Pv.js";function dt(l,e){const t=e.token={};function r(s,n,a,o){if(e.token!==t)return;e.resolved=o;let c=e.ctx;a!==void 0&&(c=c.slice(),c[a]=o);const i=s&&(e.current=s)(c);let f=!1;e.block&&(e.blocks?e.blocks.forEach((u,m)=>{m!==n&&u&&(ye(),M(u,1,1,()=>{e.blocks[m]===u&&(e.blocks[m]=null)}),Ee())}):e.block.d(1),i.c(),F(i,1),i.m(e.mount(),e.anchor),f=!0),e.block=i,e.blocks&&(e.blocks[n]=i),f&&at()}if(lt(l)){const s=nt();if(l.then(n=>{pe(s),r(e.then,1,e.value,n),pe(null)},n=>{if(pe(s),r(e.catch,2,e.error,n),pe(null),!e.hasCatch)throw n}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,l),!0;e.resolved=l}}function pt(l,e,t){const r=e.slice(),{resolved:s}=l;l.current===l.then&&(r[l.value]=s),l.current===l.catch&&(r[l.error]=s),l.block.p(r,t)}function me(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}function Re(l){let e,t=l[0].replaceAll("\\n"," ")+"",r;return{c(){e=v("mark"),r=I(t)},l(s){e=w(s,"MARK",{});var n=S(e);r=U(n,t),n.forEach(_)},m(s,n){j(s,e,n),h(e,r)},p(s,n){n&1&&t!==(t=s[0].replaceAll("\\n"," ")+"")&&Y(r,t)},d(s){s&&_(e)}}}function _t(l){let e,t=l[0]&&Re(l);return{c(){t&&t.c(),e=ie()},l(r){t&&t.l(r),e=ie()},m(r,s){t&&t.m(r,s),j(r,e,s)},p(r,[s]){r[0]?t?t.p(r,s):(t=Re(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:fe,o:fe,d(r){r&&_(e),t&&t.d(r)}}}function bt(l,e,t){let{message:r=""}=e;return l.$$set=s=>{"message"in s&&t(0,r=s.message)},[r]}class $e extends ae{constructor(e){super(),oe(this,e,bt,_t,ne,{message:0})}}function Ae(l,e,t){const r=l.slice();return r[1]=e[t],r[3]=t,r}function je(l){let e,t,r="Answer",s,n,a,o,c,i=l[0].text+"",f,u,m=me(l[0].documents),p=[];for(let d=0;d<m.length;d+=1)p[d]=Ie(Ae(l,m,d));return{c(){e=v("article"),t=v("h4"),t.textContent=r,s=R(),n=v("hr"),a=R(),o=v("blockquote"),c=v("cite"),f=I(i),u=R();for(let d=0;d<p.length;d+=1)p[d].c()},l(d){e=w(d,"ARTICLE",{});var g=S(e);t=w(g,"H4",{"data-svelte-h":!0}),he(t)!=="svelte-1n2dwgk"&&(t.textContent=r),s=A(g),n=w(g,"HR",{}),a=A(g),o=w(g,"BLOCKQUOTE",{});var b=S(o);c=w(b,"CITE",{});var T=S(c);f=U(T,i),T.forEach(_),b.forEach(_),u=A(g);for(let q=0;q<p.length;q+=1)p[q].l(g);g.forEach(_)},m(d,g){j(d,e,g),h(e,t),h(e,s),h(e,n),h(e,a),h(e,o),h(o,c),h(c,f),h(e,u);for(let b=0;b<p.length;b+=1)p[b]&&p[b].m(e,null)},p(d,g){if(g&1&&i!==(i=d[0].text+"")&&Y(f,i),g&1){m=me(d[0].documents);let b;for(b=0;b<m.length;b+=1){const T=Ae(d,m,b);p[b]?p[b].p(T,g):(p[b]=Ie(T),p[b].c(),p[b].m(e,null))}for(;b<p.length;b+=1)p[b].d(1);p.length=m.length}},d(d){d&&_(e),we(p,d)}}}function Ie(l){let e,t,r="Source "+String(l[3]+1)+" : "+l[1].position,s,n,a,o=l[1].content+"",c,i;return{c(){e=v("details"),t=v("summary"),s=I(r),n=R(),a=v("blockquote"),c=I(o),i=R()},l(f){e=w(f,"DETAILS",{});var u=S(e);t=w(u,"SUMMARY",{});var m=S(t);s=U(m,r),m.forEach(_),n=A(u),a=w(u,"BLOCKQUOTE",{});var p=S(a);c=U(p,o),p.forEach(_),i=A(u),u.forEach(_)},m(f,u){j(f,e,u),h(e,t),h(t,s),h(e,n),h(e,a),h(a,c),h(e,i)},p(f,u){u&1&&r!==(r="Source "+String(f[3]+1)+" : "+f[1].position)&&Y(s,r),u&1&&o!==(o=f[1].content+"")&&Y(c,o)},d(f){f&&_(e)}}}function gt(l){let e,t=l[0].status=="ok"&&je(l);return{c(){t&&t.c(),e=ie()},l(r){t&&t.l(r),e=ie()},m(r,s){t&&t.m(r,s),j(r,e,s)},p(r,[s]){r[0].status=="ok"?t?t.p(r,s):(t=je(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:fe,o:fe,d(r){r&&_(e),t&&t.d(r)}}}function kt(l,e,t){let{answer:r}=e;return l.$$set=s=>{"answer"in s&&t(0,r=s.answer)},[r]}class vt extends ae{constructor(e){super(),oe(this,e,kt,gt,ne,{answer:0})}}const wt=/\{[^{}]+\}/g,_e=({allowReserved:l,name:e,value:t})=>{if(t==null)return"";if(typeof t=="object")throw new Error("Deeply-nested arrays/objects arenâ€™t supported. Provide your own `querySerializer()` to handle these.");return`${e}=${l?t:encodeURIComponent(t)}`},Xe=({allowReserved:l,explode:e,name:t,style:r,value:s})=>{if(!e){const o=(l?s:s.map(c=>encodeURIComponent(c))).join((c=>{switch(c){case"form":default:return",";case"pipeDelimited":return"|";case"spaceDelimited":return"%20"}})(r));switch(r){case"label":return`.${o}`;case"matrix":return`;${t}=${o}`;case"simple":return o;default:return`${t}=${o}`}}const n=(o=>{switch(o){case"label":return".";case"matrix":return";";case"simple":return",";default:return"&"}})(r),a=s.map(o=>r==="label"||r==="simple"?l?o:encodeURIComponent(o):_e({allowReserved:l,name:t,value:o})).join(n);return r==="label"||r==="matrix"?n+a:a},Ze=({allowReserved:l,explode:e,name:t,style:r,value:s})=>{if(s instanceof Date)return`${t}=${s.toISOString()}`;if(r!=="deepObject"&&!e){let o=[];Object.entries(s).forEach(([i,f])=>{o=[...o,i,l?f:encodeURIComponent(f)]});const c=o.join(",");switch(r){case"form":return`${t}=${c}`;case"label":return`.${c}`;case"matrix":return`;${t}=${c}`;default:return c}}const n=(o=>{switch(o){case"label":return".";case"matrix":return";";case"simple":return",";default:return"&"}})(r),a=Object.entries(s).map(([o,c])=>_e({allowReserved:l,name:r==="deepObject"?`${t}[${o}]`:o,value:c})).join(n);return r==="label"||r==="matrix"?n+a:a},xe=({allowReserved:l,array:e,object:t}={})=>r=>{let s=[];if(r&&typeof r=="object")for(const n in r){const a=r[n];a!=null&&(s=Array.isArray(a)?[...s,Xe({allowReserved:l,explode:!0,name:n,style:"form",value:a,...e})]:typeof a!="object"?[...s,_e({allowReserved:l,name:n,value:a})]:[...s,Ze({allowReserved:l,explode:!0,name:n,style:"deepObject",value:a,...t})])}return s.join("&")},yt=({baseUrl:l,path:e,query:t,querySerializer:r,url:s})=>{let n=l+(s.startsWith("/")?s:`/${s}`);e&&(n=(({path:o,url:c})=>{let i=c;const f=c.match(wt);if(f)for(const u of f){let m=!1,p=u.substring(1,u.length-1),d="simple";p.endsWith("*")&&(m=!0,p=p.substring(0,p.length-1)),p.startsWith(".")?(p=p.substring(1),d="label"):p.startsWith(";")&&(p=p.substring(1),d="matrix");const g=o[p];if(g==null)continue;if(Array.isArray(g)){i=i.replace(u,Xe({explode:m,name:p,style:d,value:g}));continue}if(typeof g=="object"){i=i.replace(u,Ze({explode:m,name:p,style:d,value:g}));continue}if(d==="matrix"){i=i.replace(u,`;${_e({name:p,value:g})}`);continue}const b=encodeURIComponent(d==="label"?`.${g}`:g);i=i.replace(u,b)}return i})({path:e,url:n}));let a=t?r(t):"";return a.startsWith("?")&&(a=a.substring(1)),a&&(n+=`?${a}`),n},Ue=(l,e)=>{var r;const t={...l,...e};return(r=t.baseUrl)!=null&&r.endsWith("/")&&(t.baseUrl=t.baseUrl.substring(0,t.baseUrl.length-1)),t.headers=et(l.headers,e.headers),t},et=(...l)=>{const e=new Headers;for(const t of l){if(!t||typeof t!="object")continue;const r=t instanceof Headers?t.entries():Object.entries(t);for(const[s,n]of r)if(n===null)e.delete(s);else if(Array.isArray(n))for(const a of n)e.append(s,a);else n!==void 0&&e.set(s,typeof n=="object"?JSON.stringify(n):n)}return e};class Pe{constructor(){qe(this,"_fns");this._fns=[]}clear(){this._fns=[]}exists(e){return this._fns.indexOf(e)!==-1}eject(e){const t=this._fns.indexOf(e);t!==-1&&(this._fns=[...this._fns.slice(0,t),...this._fns.slice(t+1)])}use(e){this._fns=[...this._fns,e]}}const Ne=(l,e,t)=>{typeof t=="string"||t instanceof Blob?l.append(e,t):l.append(e,JSON.stringify(t))},Et={bodySerializer:l=>{const e=new FormData;return Object.entries(l).forEach(([t,r])=>{r!=null&&(Array.isArray(r)?r.forEach(s=>Ne(e,t,s)):Ne(e,t,r))}),e}},$t={bodySerializer:l=>JSON.stringify(l)},St=xe({allowReserved:!1,array:{explode:!0,style:"form"},object:{explode:!0,style:"deepObject"}}),Ct={"Content-Type":"application/json"},tt=(l={})=>({...$t,baseUrl:"",fetch:globalThis.fetch,headers:Ct,parseAs:"auto",querySerializer:St,...l}),qt=(l={})=>{let e=Ue(tt(),l);const t=()=>({...e}),r={request:new Pe,response:new Pe},s=async n=>{const a={...e,...n,headers:et(e.headers,n.headers)};a.body&&a.bodySerializer&&(a.body=a.bodySerializer(a.body)),a.body||a.headers.delete("Content-Type");const o=yt({baseUrl:a.baseUrl??"",path:a.path,query:a.query,querySerializer:typeof a.querySerializer=="function"?a.querySerializer:xe(a.querySerializer),url:a.url}),c={redirect:"follow",...a};let i=new Request(o,c);for(const d of r.request._fns)i=await d(i,a);const f=a.fetch;let u=await f(i);for(const d of r.response._fns)u=await d(u,i,a);const m={request:i,response:u};if(u.ok){if(u.status===204||u.headers.get("Content-Length")==="0")return{data:{},...m};if(a.parseAs==="stream")return{data:u.body,...m};const d=(a.parseAs==="auto"?(b=>{if(b)return b.startsWith("application/json")||b.endsWith("+json")?"json":b==="multipart/form-data"?"formData":["application/","audio/","image/","video/"].some(T=>b.startsWith(T))?"blob":b.startsWith("text/")?"text":void 0})(u.headers.get("Content-Type")):a.parseAs)??"json";let g=await u[d]();return d==="json"&&a.responseTransformer&&(g=await a.responseTransformer(g)),{data:g,...m}}let p=await u.text();if(a.throwOnError)throw new Error(p);try{p=JSON.parse(p)}catch{}return{error:p||{},...m}};return{connect:n=>s({...n,method:"CONNECT"}),delete:n=>s({...n,method:"DELETE"}),get:n=>s({...n,method:"GET"}),getConfig:t,head:n=>s({...n,method:"HEAD"}),interceptors:r,options:n=>s({...n,method:"OPTIONS"}),patch:n=>s({...n,method:"PATCH"}),post:n=>s({...n,method:"POST"}),put:n=>s({...n,method:"PUT"}),request:s,setConfig:n=>(e=Ue(e,n),t()),trace:n=>s({...n,method:"TRACE"})}},le=qt(tt());class de{static uploadFile(e){return((e==null?void 0:e.client)??le).post({...e,...Et,headers:{"Content-Type":null,...e==null?void 0:e.headers},url:"/upload-file"})}static importBook(e){return((e==null?void 0:e.client)??le).post({...e,url:"/import-book"})}static askQuestion(e){return((e==null?void 0:e.client)??le).post({...e,url:"/ask-question"})}static getDb(e){return((e==null?void 0:e.client)??le).get({...e,url:"/chroma"})}static clearDb(e){return((e==null?void 0:e.client)??le).delete({...e,url:"/clear_db"})}static getBooks(e){return((e==null?void 0:e.client)??le).get({...e,url:"/books"})}static getStatus(e){return((e==null?void 0:e.client)??le).get({...e,url:"/status"})}}function Be(l,e,t){const r=l.slice();return r[6]=e[t],r}function Le(l){let e,t,r,s="Ask Questions",n,a,o,c,i,f,u,m,p="Select a book",d,g,b,T,q,E,N,L,W,y,V=l[1].answer.status=="processing"?"Processing":"Ask Question",$,P,B,O,X,J,K,be,Se,ue=me(l[0]),z=[];for(let C=0;C<ue.length;C+=1)z[C]=ze(Be(l,ue,C));return O=new $e({props:{message:l[1].answer.error}}),J=new vt({props:{answer:l[1].answer}}),{c(){e=v("section"),t=v("article"),r=v("h4"),r.textContent=s,n=R(),a=v("hr"),o=R(),c=v("form"),i=v("label"),f=I(`Book
                    `),u=v("select"),m=v("option"),m.textContent=p;for(let C=0;C<z.length;C+=1)z[C].c();d=R(),g=v("label"),b=I(`Percentage
                    `),T=v("input"),q=R(),E=v("label"),N=I(`Question
                `),L=v("input"),W=R(),y=v("button"),$=I(V),B=R(),ee(O.$$.fragment),X=R(),ee(J.$$.fragment),this.h()},l(C){e=w(C,"SECTION",{id:!0});var D=S(e);t=w(D,"ARTICLE",{});var H=S(t);r=w(H,"H4",{"data-svelte-h":!0}),he(r)!=="svelte-1stl1xm"&&(r.textContent=s),n=A(H),a=w(H,"HR",{}),o=A(H),c=w(H,"FORM",{});var G=S(c);i=w(G,"LABEL",{for:!0});var Q=S(i);f=U(Q,`Book
                    `),u=w(Q,"SELECT",{name:!0,"aria-label":!0});var ce=S(u);m=w(ce,"OPTION",{"data-svelte-h":!0}),he(m)!=="svelte-1jbl809"&&(m.textContent=p);for(let ve=0;ve<z.length;ve+=1)z[ve].l(ce);ce.forEach(_),Q.forEach(_),d=A(G),g=w(G,"LABEL",{for:!0});var ge=S(g);b=U(ge,`Percentage
                    `),T=w(ge,"INPUT",{type:!0,name:!0,placeholder:!0,"aria-label":!0,min:!0,max:!0}),ge.forEach(_),q=A(G),E=w(G,"LABEL",{for:!0});var ke=S(E);N=U(ke,`Question
                `),L=w(ke,"INPUT",{type:!0,name:!0,placeholder:!0,"aria-label":!0}),ke.forEach(_),W=A(G),y=w(G,"BUTTON",{"aria-busy":!0,class:!0});var Ce=S(y);$=U(Ce,V),Ce.forEach(_),G.forEach(_),B=A(H),te(O.$$.fragment,H),H.forEach(_),X=A(D),te(J.$$.fragment,D),D.forEach(_),this.h()},h(){m.selected=!0,m.disabled=!0,m.__value="",Z(m,m.__value),k(u,"name","book"),k(u,"aria-label","Select"),u.required=!0,l[1].book===void 0&&ot(()=>l[3].call(u)),k(i,"for","book"),k(T,"type","number"),k(T,"name","percentage"),k(T,"placeholder","Percentage"),k(T,"aria-label","Percentage"),k(T,"min","0"),k(T,"max","100"),k(g,"for","percentage"),k(L,"type","search"),k(L,"name","question"),k(L,"placeholder","Your Question"),k(L,"aria-label","Search"),k(E,"for","question"),k(y,"aria-busy",P=l[1].answer.status=="processing"),k(y,"class","full-width svelte-1p1u34"),k(e,"id","questions-form")},m(C,D){j(C,e,D),h(e,t),h(t,r),h(t,n),h(t,a),h(t,o),h(t,c),h(c,i),h(i,f),h(i,u),h(u,m);for(let H=0;H<z.length;H+=1)z[H]&&z[H].m(u,null);Te(u,l[1].book,!0),h(c,d),h(c,g),h(g,b),h(g,T),Z(T,l[1].percentage),h(c,q),h(c,E),h(E,N),h(E,L),Z(L,l[1].question),h(c,W),h(c,y),h(y,$),h(t,B),re(O,t,null),h(e,X),re(J,e,null),K=!0,be||(Se=[x(u,"change",l[3]),x(T,"input",l[4]),x(L,"input",l[5]),x(y,"click",l[2])],be=!0)},p(C,D){if(D&1){ue=me(C[0]);let Q;for(Q=0;Q<ue.length;Q+=1){const ce=Be(C,ue,Q);z[Q]?z[Q].p(ce,D):(z[Q]=ze(ce),z[Q].c(),z[Q].m(u,null))}for(;Q<z.length;Q+=1)z[Q].d(1);z.length=ue.length}D&3&&Te(u,C[1].book),D&3&&Ve(T.value)!==C[1].percentage&&Z(T,C[1].percentage),D&3&&L.value!==C[1].question&&Z(L,C[1].question),(!K||D&2)&&V!==(V=C[1].answer.status=="processing"?"Processing":"Ask Question")&&Y($,V),(!K||D&3&&P!==(P=C[1].answer.status=="processing"))&&k(y,"aria-busy",P);const H={};D&2&&(H.message=C[1].answer.error),O.$set(H);const G={};D&2&&(G.answer=C[1].answer),J.$set(G)},i(C){K||(F(O.$$.fragment,C),F(J.$$.fragment,C),K=!0)},o(C){M(O.$$.fragment,C),M(J.$$.fragment,C),K=!1},d(C){C&&_(e),we(z,C),se(O),se(J),be=!1,Ke(Se)}}}function ze(l){let e,t=l[6].title+"",r,s,n;return{c(){e=v("option"),r=I(t),s=R(),this.h()},l(a){e=w(a,"OPTION",{});var o=S(e);r=U(o,t),s=A(o),o.forEach(_),this.h()},h(){e.__value=n=l[6].uuid,Z(e,e.__value)},m(a,o){j(a,e,o),h(e,r),h(e,s)},p(a,o){o&1&&t!==(t=a[6].title+"")&&Y(r,t),o&1&&n!==(n=a[6].uuid)&&(e.__value=n,Z(e,e.__value))},d(a){a&&_(e)}}}function Tt(l){let e,t,r=l[0]&&Le(l);return{c(){r&&r.c(),e=ie()},l(s){r&&r.l(s),e=ie()},m(s,n){r&&r.m(s,n),j(s,e,n),t=!0},p(s,[n]){s[0]?r?(r.p(s,n),n&1&&F(r,1)):(r=Le(s),r.c(),F(r,1),r.m(e.parentNode,e)):r&&(ye(),M(r,1,1,()=>{r=null}),Ee())},i(s){t||(F(r),t=!0)},o(s){M(r),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Ot(l,e,t){let{books:r}=e,s={question:"",book:"",percentage:100,answer:{text:"",documents:[],status:"idle",error:""}};async function n(){var i;try{t(1,s.answer={text:"",documents:[],status:"processing",error:""},s);const f=await de.askQuestion({body:s});(i=f.data)!=null&&i.answer?(t(1,s.answer.text=f.data.answer,s),t(1,s.answer.documents=f.data.documents,s),t(1,s.answer.status="ok",s)):(t(1,s.answer.error=JSON.stringify(f.error),s),t(1,s.answer.status="error",s))}catch(f){t(1,s.answer.status="error",s),t(1,s.answer.error=String(f),s)}}function a(){s.book=ut(this),t(1,s),t(0,r)}function o(){s.percentage=Ve(this.value),t(1,s),t(0,r)}function c(){s.question=this.value,t(1,s),t(0,r)}return l.$$set=i=>{"books"in i&&t(0,r=i.books)},[r,s,n,a,o,c]}class Rt extends ae{constructor(e){super(),oe(this,e,Ot,Tt,ne,{books:0})}}function De(l){let e,t,r;return{c(){e=v("img"),this.h()},l(s){e=w(s,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){k(e,"class","full-width svelte-zdk8qr"),Oe(e.src,t=l[0].formats["image/jpeg"])||k(e,"src",t),k(e,"alt",r=l[0].title)},m(s,n){j(s,e,n)},p(s,n){n&1&&!Oe(e.src,t=s[0].formats["image/jpeg"])&&k(e,"src",t),n&1&&r!==(r=s[0].title)&&k(e,"alt",r)},d(s){s&&_(e)}}}function He(l){let e,t=l[0].authors.map(Fe).reduce(We)+"",r;return{c(){e=v("p"),r=I(t),this.h()},l(s){e=w(s,"P",{class:!0});var n=S(e);r=U(n,t),n.forEach(_),this.h()},h(){k(e,"class","text svelte-zdk8qr")},m(s,n){j(s,e,n),h(e,r)},p(s,n){n&1&&t!==(t=s[0].authors.map(Fe).reduce(We)+"")&&Y(r,t)},d(s){s&&_(e)}}}function Qe(l){let e,t,r=l[0].languages.reduce(Me)+"",s;return{c(){e=v("p"),t=I("Language : "),s=I(r)},l(n){e=w(n,"P",{});var a=S(e);t=U(a,"Language : "),s=U(a,r),a.forEach(_)},m(n,a){j(n,e,a),h(e,t),h(e,s)},p(n,a){a&1&&r!==(r=n[0].languages.reduce(Me)+"")&&Y(s,r)},d(n){n&&_(e)}}}function At(l){let e,t,r,s,n,a,o=l[0].title+"",c,i,f,u,m,p,d=l[0].formats["image/jpeg"]&&De(l),g=l[0].authors.length>0&&He(l),b=l[0].languages.length>0&&Qe(l);const T=l[2].default,q=ct(T,l,l[1],null);return{c(){e=v("article"),t=v("figure"),d&&d.c(),r=R(),s=v("div"),n=v("hgroup"),a=v("h5"),c=I(o),i=R(),g&&g.c(),f=R(),b&&b.c(),u=R(),m=v("div"),q&&q.c(),this.h()},l(E){e=w(E,"ARTICLE",{class:!0});var N=S(e);t=w(N,"FIGURE",{class:!0});var L=S(t);d&&d.l(L),L.forEach(_),r=A(N),s=w(N,"DIV",{});var W=S(s);n=w(W,"HGROUP",{});var y=S(n);a=w(y,"H5",{class:!0});var V=S(a);c=U(V,o),V.forEach(_),i=A(y),g&&g.l(y),f=A(y),b&&b.l(y),y.forEach(_),W.forEach(_),u=A(N),m=w(N,"DIV",{class:!0});var $=S(m);q&&q.l($),$.forEach(_),N.forEach(_),this.h()},h(){k(t,"class","full-width flex-grow svelte-zdk8qr"),k(a,"class","text svelte-zdk8qr"),k(m,"class","end full-width svelte-zdk8qr"),k(e,"class","flex svelte-zdk8qr")},m(E,N){j(E,e,N),h(e,t),d&&d.m(t,null),h(e,r),h(e,s),h(s,n),h(n,a),h(a,c),h(n,i),g&&g.m(n,null),h(n,f),b&&b.m(n,null),h(e,u),h(e,m),q&&q.m(m,null),p=!0},p(E,[N]){E[0].formats["image/jpeg"]?d?d.p(E,N):(d=De(E),d.c(),d.m(t,null)):d&&(d.d(1),d=null),(!p||N&1)&&o!==(o=E[0].title+"")&&Y(c,o),E[0].authors.length>0?g?g.p(E,N):(g=He(E),g.c(),g.m(n,f)):g&&(g.d(1),g=null),E[0].languages.length>0?b?b.p(E,N):(b=Qe(E),b.c(),b.m(n,null)):b&&(b.d(1),b=null),q&&q.p&&(!p||N&2)&&it(q,T,E,E[1],p?ht(T,E[1],N,null):ft(E[1]),null)},i(E){p||(F(q,E),p=!0)},o(E){M(q,E),p=!1},d(E){E&&_(e),d&&d.d(),g&&g.d(),b&&b.d(),q&&q.d(E)}}}const Fe=l=>l.name,We=(l,e)=>l+", "+e,Me=(l,e)=>l+", "+e;function jt(l,e,t){let{$$slots:r={},$$scope:s}=e,{book:n}=e;return l.$$set=a=>{"book"in a&&t(0,n=a.book),"$$scope"in a&&t(1,s=a.$$scope)},[n,s,r]}class It extends ae{constructor(e){super(),oe(this,e,jt,At,ne,{book:0})}}function Je(l,e,t){const r=l.slice();return r[7]=e[t],r}function Ut(l){let e;return{c(){e=I("Error")},l(t){e=U(t,"Error")},m(t,r){j(t,e,r)},d(t){t&&_(e)}}}function Pt(l){let e;return{c(){e=I("Success !")},l(t){e=U(t,"Success !")},m(t,r){j(t,e,r)},d(t){t&&_(e)}}}function Nt(l){let e;return{c(){e=I("Processing")},l(t){e=U(t,"Processing")},m(t,r){j(t,e,r)},d(t){t&&_(e)}}}function Bt(l){let e;return{c(){e=I("Import")},l(t){e=U(t,"Import")},m(t,r){j(t,e,r)},d(t){t&&_(e)}}}function Lt(l){let e,t,r,s,n;function a(f,u){return f[1].status=="idle"?Bt:f[1].status=="processing"?Nt:f[1].status=="ok"?Pt:Ut}let o=a(l),c=o(l);function i(){return l[5](l[7])}return{c(){e=v("button"),c.c(),r=R(),this.h()},l(f){e=w(f,"BUTTON",{"aria-busy":!0,class:!0});var u=S(e);c.l(u),u.forEach(_),r=A(f),this.h()},h(){k(e,"aria-busy",t=l[1].status=="processing"),k(e,"class","full-width svelte-t0qkv2")},m(f,u){j(f,e,u),c.m(e,null),j(f,r,u),s||(n=x(e,"click",i),s=!0)},p(f,u){l=f,o!==(o=a(l))&&(c.d(1),c=o(l),c&&(c.c(),c.m(e,null))),u&2&&t!==(t=l[1].status=="processing")&&k(e,"aria-busy",t)},d(f){f&&(_(e),_(r)),c.d(),s=!1,n()}}}function Ge(l){let e,t;return e=new It({props:{book:l[7],$$slots:{default:[Lt]},$$scope:{ctx:l}}}),{c(){ee(e.$$.fragment)},l(r){te(e.$$.fragment,r)},m(r,s){re(e,r,s),t=!0},p(r,s){const n={};s&1&&(n.book=r[7]),s&1027&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(F(e.$$.fragment,r),t=!0)},o(r){M(e.$$.fragment,r),t=!1},d(r){se(e,r)}}}function zt(l){let e,t,r,s="Search Public Domain Books",n,a,o,c,i,f,u,m=l[0].status=="processing"?"Processing":"Search",p,d,g,b,T,q,E,N,L,W=me(l[0].results),y=[];for(let $=0;$<W.length;$+=1)y[$]=Ge(Je(l,W,$));const V=$=>M(y[$],1,1,()=>{y[$]=null});return q=new $e({props:{message:l[1].error}}),{c(){e=v("section"),t=v("article"),r=v("h4"),r.textContent=s,n=R(),a=v("hr"),o=R(),c=v("form"),i=v("input"),f=R(),u=v("button"),p=I(m),g=R(),b=v("div");for(let $=0;$<y.length;$+=1)y[$].c();T=R(),ee(q.$$.fragment),this.h()},l($){e=w($,"SECTION",{id:!0});var P=S(e);t=w(P,"ARTICLE",{});var B=S(t);r=w(B,"H4",{"data-svelte-h":!0}),he(r)!=="svelte-16fk5mr"&&(r.textContent=s),n=A(B),a=w(B,"HR",{}),o=A(B),c=w(B,"FORM",{});var O=S(c);i=w(O,"INPUT",{type:!0,name:!0,placeholder:!0,"aria-label":!0}),f=A(O),u=w(O,"BUTTON",{"aria-busy":!0,class:!0});var X=S(u);p=U(X,m),X.forEach(_),O.forEach(_),g=A(B),b=w(B,"DIV",{class:!0});var J=S(b);for(let K=0;K<y.length;K+=1)y[K].l(J);J.forEach(_),T=A(B),te(q.$$.fragment,B),B.forEach(_),P.forEach(_),this.h()},h(){k(i,"type","search"),k(i,"name","search"),k(i,"placeholder","Search Book"),k(i,"aria-label","Search"),k(u,"aria-busy",d=l[0].status=="processing"),k(u,"class","full-width svelte-t0qkv2"),k(b,"class","grid overflow-auto svelte-t0qkv2"),k(e,"id","search-form")},m($,P){j($,e,P),h(e,t),h(t,r),h(t,n),h(t,a),h(t,o),h(t,c),h(c,i),Z(i,l[0].search),h(c,f),h(c,u),h(u,p),h(t,g),h(t,b);for(let B=0;B<y.length;B+=1)y[B]&&y[B].m(b,null);h(t,T),re(q,t,null),E=!0,N||(L=[x(i,"input",l[4]),x(u,"click",l[2])],N=!0)},p($,[P]){if(P&1&&i.value!==$[0].search&&Z(i,$[0].search),(!E||P&1)&&m!==(m=$[0].status=="processing"?"Processing":"Search")&&Y(p,m),(!E||P&1&&d!==(d=$[0].status=="processing"))&&k(u,"aria-busy",d),P&11){W=me($[0].results);let O;for(O=0;O<W.length;O+=1){const X=Je($,W,O);y[O]?(y[O].p(X,P),F(y[O],1)):(y[O]=Ge(X),y[O].c(),F(y[O],1),y[O].m(b,null))}for(ye(),O=W.length;O<y.length;O+=1)V(O);Ee()}const B={};P&2&&(B.message=$[1].error),q.$set(B)},i($){if(!E){for(let P=0;P<W.length;P+=1)F(y[P]);F(q.$$.fragment,$),E=!0}},o($){y=y.filter(Boolean);for(let P=0;P<y.length;P+=1)M(y[P]);M(q.$$.fragment,$),E=!1},d($){$&&_(e),we(y,$),se(q),N=!1,Ke(L)}}}function Dt(l,e,t){const r=Ye();let s={search:"",status:"idle",results:[]},n={status:"idle",error:""};async function a(){t(0,s.status="processing",s),t(1,n.status="idle",n),t(1,n.error="",n),t(0,s.results=[],s);const f="https://gutendex.com/books?search="+s.search.replaceAll(" ","%20"),u=await fetch(f,{method:"GET"}),m=await u.json();if(u.ok&&m.results.length>0)t(0,s.results=m.results,s),t(0,s.status="ok",s);else throw new Error(u.statusText)}async function o(f){t(1,n.status="processing",n),t(1,n.error="",n),t(0,s.results=[f],s);const u=await de.importBook({body:f});u.response.ok?(t(1,n.status="ok",n),setTimeout(()=>{t(0,s.results=[],s)},3e3),r("new-book")):(t(1,n.status="error",n),t(1,n.error=JSON.stringify(u.error),n))}function c(){s.search=this.value,t(0,s)}return[s,n,a,o,c,f=>o(f)]}class Ht extends ae{constructor(e){super(),oe(this,e,Dt,zt,ne,{})}}function Qt(l){let e,t,r=l[5].message+"",s,n;return{c(){e=v("span"),t=I('Server unavailable: "'),s=I(r),n=I('"')},l(a){e=w(a,"SPAN",{});var o=S(e);t=U(o,'Server unavailable: "'),s=U(o,r),n=U(o,'"'),o.forEach(_)},m(a,o){j(a,e,o),h(e,t),h(e,s),h(e,n)},p:fe,d(a){a&&_(e)}}}function Ft(l){let e,t,r,s,n,a,o;function c(u,m){return u[0].status=="idle"?Gt:u[0].status=="processing"?Jt:u[0].status=="ok"?Mt:Wt}let i=c(l),f=i(l);return{c(){e=v("form"),t=v("input"),r=R(),s=v("button"),f.c(),this.h()},l(u){e=w(u,"FORM",{});var m=S(e);t=w(m,"INPUT",{type:!0,id:!0,name:!0,accept:!0}),r=A(m),s=w(m,"BUTTON",{"aria-busy":!0,class:!0});var p=S(s);f.l(p),p.forEach(_),m.forEach(_),this.h()},h(){k(t,"type","file"),k(t,"id","file"),k(t,"name","file"),k(t,"accept",".epub"),k(s,"aria-busy",n=l[0].status=="processing"),k(s,"class","full-width svelte-1p1u34")},m(u,m){j(u,e,m),h(e,t),h(e,r),h(e,s),f.m(s,null),a||(o=x(s,"click",l[1]),a=!0)},p(u,m){i!==(i=c(u))&&(f.d(1),f=i(u),f&&(f.c(),f.m(s,null))),m&1&&n!==(n=u[0].status=="processing")&&k(s,"aria-busy",n)},d(u){u&&_(e),f.d(),a=!1,o()}}}function Wt(l){let e;return{c(){e=I("Error")},l(t){e=U(t,"Error")},m(t,r){j(t,e,r)},d(t){t&&_(e)}}}function Mt(l){let e;return{c(){e=I("Success !")},l(t){e=U(t,"Success !")},m(t,r){j(t,e,r)},d(t){t&&_(e)}}}function Jt(l){let e;return{c(){e=I("Processing")},l(t){e=U(t,"Processing")},m(t,r){j(t,e,r)},d(t){t&&_(e)}}}function Gt(l){let e;return{c(){e=I("Upload")},l(t){e=U(t,"Upload")},m(t,r){j(t,e,r)},d(t){t&&_(e)}}}function Vt(l){let e,t="Checking server status...";return{c(){e=v("span"),e.textContent=t,this.h()},l(r){e=w(r,"SPAN",{"aria-busy":!0,"data-svelte-h":!0}),he(e)!=="svelte-r6f49d"&&(e.textContent=t),this.h()},h(){k(e,"aria-busy","true")},m(r,s){j(r,e,s)},p:fe,d(r){r&&_(e)}}}function Kt(l){let e,t,r,s="Import Epub Files",n,a,o,c,i,f,u={ctx:l,current:null,token:null,hasCatch:!0,pending:Vt,then:Ft,catch:Qt,value:4,error:5};return dt(l[2](),u),i=new $e({props:{message:l[0].error}}),{c(){e=v("section"),t=v("article"),r=v("h4"),r.textContent=s,n=R(),a=v("hr"),o=R(),u.block.c(),c=R(),ee(i.$$.fragment),this.h()},l(m){e=w(m,"SECTION",{id:!0});var p=S(e);t=w(p,"ARTICLE",{});var d=S(t);r=w(d,"H4",{"data-svelte-h":!0}),he(r)!=="svelte-tnb7qc"&&(r.textContent=s),n=A(d),a=w(d,"HR",{}),o=A(d),u.block.l(d),c=A(d),te(i.$$.fragment,d),d.forEach(_),p.forEach(_),this.h()},h(){k(e,"id","upload-form")},m(m,p){j(m,e,p),h(e,t),h(t,r),h(t,n),h(t,a),h(t,o),u.block.m(t,u.anchor=null),u.mount=()=>t,u.anchor=c,h(t,c),re(i,t,null),f=!0},p(m,[p]){l=m,pt(u,l,p);const d={};p&1&&(d.message=l[0].error),i.$set(d)},i(m){f||(F(i.$$.fragment,m),f=!0)},o(m){M(i.$$.fragment,m),f=!1},d(m){m&&_(e),u.block.d(),u.token=null,u=null,se(i)}}}function Yt(l,e,t){const r=Ye();let s={status:"idle",error:""};async function n(){const o=document.getElementById("file");if(o.files){t(0,s.status="processing",s),t(0,s.error="",s);try{const c=await de.uploadFile({body:{file:o.files[0]}});c.response.ok?(t(0,s.status="ok",s),r("new-book")):t(0,s.error=JSON.stringify(c.error),s)}catch(c){t(0,s.error=String(c),s)}}}async function a(){const o=await de.getStatus();if(o.response.ok)return o.data;throw new Error(o.response.statusText)}return[s,n,a]}class Xt extends ae{constructor(e){super(),oe(this,e,Yt,Kt,ne,{})}}function Zt(l){let e,t,r,s,n,a;return e=new Rt({props:{books:l[0]}}),r=new Ht({}),r.$on("new-book",l[1]),n=new Xt({}),n.$on("new-book",l[1]),{c(){ee(e.$$.fragment),t=R(),ee(r.$$.fragment),s=R(),ee(n.$$.fragment)},l(o){te(e.$$.fragment,o),t=A(o),te(r.$$.fragment,o),s=A(o),te(n.$$.fragment,o)},m(o,c){re(e,o,c),j(o,t,c),re(r,o,c),j(o,s,c),re(n,o,c),a=!0},p(o,[c]){const i={};c&1&&(i.books=o[0]),e.$set(i)},i(o){a||(F(e.$$.fragment,o),F(r.$$.fragment,o),F(n.$$.fragment,o),a=!0)},o(o){M(e.$$.fragment,o),M(r.$$.fragment,o),M(n.$$.fragment,o),a=!1},d(o){o&&(_(t),_(s)),se(e,o),se(r,o),se(n,o)}}}function xt(l,e,t){let r;mt(s);async function s(){try{const n=await de.getBooks();n.data&&n.data.length>0?(t(0,r=n.data),console.log(n)):console.error("No books found:",n.error)}catch(n){console.error("Fetch error:",n)}}return[r,s]}class sr extends ae{constructor(e){super(),oe(this,e,xt,Zt,ne,{})}}export{sr as component};
